:github_url: https://github.com/solace-iot-team/ansible-solace-collection/tree/main/src/ansible_collections/solace/pubsub_plus/plugins/modules/solace_gather_facts.py

.. _solace_gather_facts_module:

solace_gather_facts -- gather broker facts
==========================================

Retrieve facts from the Solace broker and set 'ansible_facts.solace'. Call at the beginning of the playbook so all subsequent tasks can use '{{ ansible_facts.solace.<path-to-fact> }}' or :ref:`solace_get_facts <solace_get_facts_module>` module. Supports Solace Cloud and standalone brokers. Retrieves: service/broker info, about info, virtual router name, messaging endpoints, etc.





Examples
--------

.. code-block:: yaml+jinja

   
   hosts: all
   gather_facts: no
   any_errors_fatal: true
   collections:
   - solace.pubsub_plus
   module_defaults:
     solace_gather_facts:
       host: "{{ sempv2_host }}"
       port: "{{ sempv2_port }}"
       secure_connection: "{{ sempv2_is_secure_connection }}"
       username: "{{ sempv2_username }}"
       password: "{{ sempv2_password }}"
       timeout: "{{ sempv2_timeout }}"
       solace_cloud_api_token: "{{ SOLACE_CLOUD_API_TOKEN if broker_type=='solace_cloud' else omit }}"
       solace_cloud_service_id: "{{ solace_cloud_service_id | default(omit) }}"
   tasks:
   - name: Gather Solace Facts
     solace_gather_facts:

   - name: "Save hostvars to ./hostvars.json"
     copy:
       content: "{{ hostvars | to_nice_json }}"
       dest: ./hostvars.json
     delegate_to: localhost



Notes
-----

.. note::
   - In order to access other hosts' (other than the current 'inventory_host') facts, you must not use the 'serial' strategy for the playbook.
   - Module Sempv2 Config - about: https://docs.solace.com/API-Developer-Online-Ref-Documentation/swagger-ui/config/index.html#/about
   - Module Sempv2 Config - broker: https://docs.solace.com/API-Developer-Online-Ref-Documentation/swagger-ui/config/index.html#/all/getBroker
   - Module Solace Cloud Api - get service: https://docs.solace.com/Solace-Cloud/ght_use_rest_api_services.htm
   - Sempv2 Config Reference: https://docs.solace.com/API-Developer-Online-Ref-Documentation/swagger-ui/config/index.html#/
   - Sempv2 Monitor Reference: https://docs.solace.com/API-Developer-Online-Ref-Documentation/swagger-ui/monitor/index.html#/
   - Sempv2 Action Reference: https://docs.solace.com/API-Developer-Online-Ref-Documentation/swagger-ui/action/index.html#/


See Also
--------

.. seealso::

   - :ref:`solace_get_facts_module`
   - :ref:`solace_cloud_account_gather_facts_module`



Parameters
----------

host (optional)
  Hostname of Solace Broker.

  | **type**: str
  | **default**: localhost

password (optional)
  Administrator password for Solace Broker.

  | **type**: str
  | **default**: admin

port (optional)
  Management port of Solace Broker.

  | **type**: int
  | **default**: 8080

reverse_proxy (optional)
  Use a reverse proxy / api gateway. Note: **Experimental. Not permitted for Solace Cloud API**.

  | **type**: dict

  headers (optional)
    Additional headers to add to the http call. Example: 'apiKey: {my-api-key}'.

    | **type**: dict

    x-asc-module (optional)
      Flag for the module to add the header 'x-asc-module:{module-name}' to the http call with it's module name.

      | **type**: bool
      | **default**: False

    x-asc-module-op (optional)
      Flag for the module to add the header 'x-asc-module-op:{module operation}' to the http call with the module's operation.

      | **type**: bool
      | **default**: False


  query_params (optional)
    Additional query paramters to add to the URL. Example: 'apiCode: {my-api-code}'.

    | **type**: dict

  semp_base_path (optional)
    Base path prepended to all SEMP calls. Example: 'my/base/path'. Resulting URL will be: http(s)://{host}:{port}/{semp_base_path}/{module-semp-call-path}

    | **type**: str

  use_basic_auth (optional)
    Flag to use basic authentication in the http(s) call or not. Uses 'username'/'password'.

    | **type**: bool
    | **default**: False


secure_connection (optional)
  If true, use https rather than http.

  | **type**: bool
  | **default**: False

solace_cloud_api_token (optional)
  The API Token.

  Generate using Solace Cloud console with the appropriate permissions for the operations you want to enable.

  Either both (solace_cloud_api_token AND solace_cloud_service_id) must be provided or none.

  | **type**: str

solace_cloud_service_id (optional)
  The service id in Solace Cloud.

  Click on the service in Solace Cloud - the service id is in the URL.

  Either both (solace_cloud_api_token AND solace_cloud_service_id) must be provided or none.

  | **type**: str

timeout (optional)
  Connection timeout in seconds for the http request.

  | **type**: int
  | **default**: 10

username (optional)
  Administrator username for Solace Broker.

  | **type**: str
  | **default**: admin

x_broker (optional)
  Custom HTTP header with the broker virtual router id, if using a SEMPv2 Proxy/agent infrastructure.

  | **type**: str





Return Values
-------------

ansible_facts
  The facts as returned by the APIs. Element: 'solace'.

  | **returned**: success
  | **type**: dict
  | **sample**:

  .. code-block:: json

     {
     "ansible_facts": {
       "solace": {
         "about": {
           "api": {
             "platform": "VMR",
             "sempVersion": "2.17"
           },
           "user": {
             "globalAccessLevel": "VALUE_SPECIFIED_IN_NO_LOG_PARAMETER",
             "msgVpns": [
               {
                 "accessLevel": "read-write",
                 "msgVpnName": "default"
               }
             ]
           }
         },
         "isSolaceCloud": false,
         "service_facts": {
           "info": "various service/broker info"
         }
       }
     }
   }

rc
  Return code. rc=0 on success, rc=1 on error.

  | **returned**: always
  | **type**: int
  | **sample**:

  .. code-block:: json

     {
     "error": {
       "rc": 1
     },
     "success": {
       "rc": 0
     }
   }

msg
  The response from the HTTP call in case of error.

  | **returned**: error
  | **type**: dict


